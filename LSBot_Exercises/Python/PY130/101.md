# PY130 - Closures, Decorators & Partial Functions
## Problem 101: Authentication Decorator Factory

Create a decorator called `require_auth(role)` that checks if a user has the required role before allowing a function to execute. The decorator should check a global `current_user` dictionary.

## Examples:

```python
current_user = {'username': 'alice', 'role': 'admin'}

@require_auth('admin')
def delete_user(user_id):
    return f"User {user_id} deleted"

@require_auth('admin')
def view_logs():
    return "Viewing system logs"

@require_auth('user')
def view_profile():
    return "Viewing profile"

print(delete_user(123))  # Works - alice is admin
current_user['role'] = 'user'
print(delete_user(456))  # Fails - user is not admin
print(view_profile())    # Works - user role is sufficient
```
<details>
<summary>Solution:</summary>
We first define a decorator factory where we pass an argument. Within the factory, we define a decorator which accepts func as an argument. Finally, we define the wrapper function which calls the original function.

The decorator syntax is desugared to `delete_user = require_auth('admin')(delete_user)`.

1. `require_auth('admin')` is executed first. This is the call to the "decorator factory." It returns the deco function.
2.  The expression now becomes `deco(delete_user)`. The deco function is called with the original delete_user function as its argument.
3.  `deco(delete_user)` executes and returns the `wrapper` function.
4.  Finally, the name `delete_user` is rebound to the `wrapper` function that was returned.

In summary;
`delete_user = require_auth(‘admin’)(delete_user)`
`delete_user = deco(delete_user)`
`delete_user = wrapper`


```python
def require_auth(role):                 # decorator factory
    def deco(func):                     # decorator
        def wrapper(*args, **kwargs):   # wrapper
            if current_user['role'] == role:
                return func(*args, **kwargs)
            else:
                return "Insufficient access"
        return wrapper
    return deco
    
```

</details>

---

[Previous](100.md) | [Next](102.md)