<p align="right">
  <a id="spot-launch-btn" class="spot-editor-link" href="https://launchschool.com/the-spot?url=https://github.com/The-SPOT-Hub/SPOT-Wiki/blob/main/LSBot_Exercises/Javascript/TS240/04.md" target="_blank">
  <img src="https://img.shields.io/badge/Work%20in%20LS%20Code%20Editor-555?style=flat&logo=data%3Aimage%2Fsvg%2Bxml%3Bbase64%2CPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48ZyBmaWxsPSIjZjM1YjVhIj48cGF0aCBkPSJNOTgsMS45Yy0yLjUtMi41LTYuNi0yLjUtOS4xLDBMMjcuMiw2My43Yy0yLjUsMi41LTIuNSw2LjYsMCw5LjFjMi41LDIuNSw2LjYsMi41LDkuMSwwTDk4LDExLjFDMTAwLjYsOC41LDEwMC41LDQuNSw5OCwxLjl6Ii8%2BPHBhdGggZD0iTTg4LjksNzQuOWwtMTQsMTRjLTIuNSwyLjUtMi41LDYuNiwwLDkuMWMyLjUsMi41LDYuNiwyLjUsOS4xLDBsMTQtMTRjMi41LTIuNSwyLjUtNi42LDAtOS4xQzk1LjUsNzIuNCw5MS40LDcyLjQsODguOSw3NC45eiIvPjxwYXRoIGQ9Ik05OC4xLDM4LjRjLTIuNS0yLjUtNi42LTIuNS05LjEsMEw2Mi43LDY0LjZjLTIuNSwyLjUtMi41LDYuNiwwLDkuMWMyLjUsMi41LDYuNiwyLjUsOS4xLDBsMjYuMy0yNi4zQzEwMC42LDQ1LDEwMC42LDQwLjksOTguMSwzOC40eiIvPjxwYXRoIGQ9Ik0yNSwyYy0yLjUtMi41LTYuNi0yLjUtOS4xLDBsLTE0LDE0Yy0yLjUsMi41LTIuNSw2LjYsMCw5LjFjMi41LDIuNSw2LjYsMi41LDkuMSwwbDE0LTE0QzI3LjYsOC42LDI3LjYsNC41LDI1LDJ6Ii8%2BPHBhdGggZD0iTTM1LjQsMzcuM0w2MS42LDExYzIuNS0yLjUsMi41LTYuNiwwLTkuMWMtMi41LTIuNS02LjYtMi41LTkuMSwwTDI2LjIsMjguMmMtMi41LDIuNS0yLjUsNi42LDAsOS4xQzI4LjgsMzkuOCwzMi44LDM5LjgsMzUuNCwzNy4zeiIvPjwvZz48L3N2Zz4%3D" alt="Work in LS Code Editor">
</a>
</p>

# TS240
## Problem 4: Type Narrowing Debugging

The following function is intended to calculate the total area of one or more shapes. It's currently throwing a TypeScript error. Identify the error, explain why it's happening, and provide the corrected code.

```typescript
// Original buggy code
type Circle = { kind: 'circle'; radius: number };
type Square = { kind: 'square'; sideLength: number };
type Shape = Circle | Square;

function calculateTotalArea(shape: Shape | Shape[]): number {
  let total = 0;
  // This condition is problematic
  if (shape.length) { 
    shape.forEach(s => {
      // ... implementation for array ...
    });
  } else {
    // ... implementation for single shape ...
  }
  return total;
}
```

<details>
<summary>Solution:</summary>

**Explanation of the Error:**

The error occurs at `if (shape.length)`. TypeScript sees that `shape` can be a single `Shape` object (`Circle` or `Square`) or a `Shape[]` (an array). The `Circle` and `Square` types do not have a `length` property, so the compiler raises an error: Property 'length' does not exist on type 'Shape'. To fix this, we need a reliable way to check if `shape` is an array.

**Corrected Code:**

The `Array.isArray()` method is the correct type guard to use here to differentiate between an object and an array.

```typescript
type Circle = { kind: 'circle'; radius: number };
type Square = { kind: 'square'; sideLength: number };
type Shape = Circle | Square;

function calculateSingleShapeArea(shape: Shape): number {
  if (shape.kind === 'circle') {
    return Math.PI * shape.radius ** 2;
  } else {
    return shape.sideLength ** 2;
  }
}

function calculateTotalArea(shapeOrShapes: Shape | Shape[]): number {
  if (Array.isArray(shapeOrShapes)) {
    // It's an array of shapes
    return shapeOrShapes.reduce((total, s) => total + calculateSingleShapeArea(s), 0);
  } else {
    // It's a single shape
    return calculateSingleShapeArea(shapeOrShapes);
  }
}

// Example Usage
const circle: Circle = { kind: 'circle', radius: 10 };
const square: Square = { kind: 'square', sideLength: 5 };

console.log(calculateTotalArea(circle)); // ~314.159
console.log(calculateTotalArea([circle, square])); // ~339.159
```

</details>

---

[Previous](03.md) | [Next](05.md)