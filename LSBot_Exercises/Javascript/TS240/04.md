# TS240
## Problem 4: Type Narrowing Debugging

The following function is intended to calculate the total area of one or more shapes. It's currently throwing a TypeScript error. Identify the error, explain why it's happening, and provide the corrected code.

```typescript
// Original buggy code
type Circle = { kind: 'circle'; radius: number };
type Square = { kind: 'square'; sideLength: number };
type Shape = Circle | Square;

function calculateTotalArea(shape: Shape | Shape[]): number {
  let total = 0;
  // This condition is problematic
  if (shape.length) { 
    shape.forEach(s => {
      // ... implementation for array ...
    });
  } else {
    // ... implementation for single shape ...
  }
  return total;
}
```

<details>
<summary>Solution:</summary>

**Explanation of the Error:**

The error occurs at `if (shape.length)`. TypeScript sees that `shape` can be a single `Shape` object (`Circle` or `Square`) or a `Shape[]` (an array). The `Circle` and `Square` types do not have a `length` property, so the compiler raises an error: Property 'length' does not exist on type 'Shape'. To fix this, we need a reliable way to check if `shape` is an array.

**Corrected Code:**

The `Array.isArray()` method is the correct type guard to use here to differentiate between an object and an array.

```typescript
type Circle = { kind: 'circle'; radius: number };
type Square = { kind: 'square'; sideLength: number };
type Shape = Circle | Square;

function calculateSingleShapeArea(shape: Shape): number {
  if (shape.kind === 'circle') {
    return Math.PI * shape.radius ** 2;
  } else {
    return shape.sideLength ** 2;
  }
}

function calculateTotalArea(shapeOrShapes: Shape | Shape[]): number {
  if (Array.isArray(shapeOrShapes)) {
    // It's an array of shapes
    return shapeOrShapes.reduce((total, s) => total + calculateSingleShapeArea(s), 0);
  } else {
    // It's a single shape
    return calculateSingleShapeArea(shapeOrShapes);
  }
}

// Example Usage
const circle: Circle = { kind: 'circle', radius: 10 };
const square: Square = { kind: 'square', sideLength: 5 };

console.log(calculateTotalArea(circle)); // ~314.159
console.log(calculateTotalArea([circle, square])); // ~339.159
```

</details>

---

[Previous](03.md) | [Next](05.md)