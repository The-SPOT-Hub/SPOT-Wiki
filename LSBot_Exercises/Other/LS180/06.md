# LS180
## Problem 6: Debugging Aggregate Functions

**Debugging**: The following query is intended to return each `department_id` and the average salary of its employees, but only for departments where the average salary is over $60,000. It is failing. Identify the error and provide the corrected query.

```sql
-- Original Failing Query
SELECT department_id, AVG(salary)
FROM employees
WHERE AVG(salary) > 60000
GROUP BY department_id;
```

<details>
<summary>Solution:</summary>

The error is using an aggregate function (`AVG(salary)`) in the `WHERE` clause. The `WHERE` clause filters rows before aggregation. The `HAVING` clause must be used to filter groups after aggregation.

```sql
-- Corrected Query
SELECT department_id, AVG(salary)
FROM employees
GROUP BY department_id
HAVING AVG(salary) > 60000;
```

</details>

---

[Previous](05.md) | [Next](07.md)

